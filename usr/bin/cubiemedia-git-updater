#!/bin/bash

# this script is only for none snap environment

while :
do
  echo "Checking for updates..."
  UPDATE=0
  git remote update && git status -uno | grep -q 'Your branch is behind' && UPDATE=1

  if [ $UPDATE = 1 ]
  then
    echo "Update [$UPDATE] found ... "
    echo "Clean repository ..."
    git clean -f ./*/__pycache__
    git clean -f ./*/*/__pycache__
    echo "Stash changes ..."
    git -c user.name="CubieMedia" -c user.email="info@cubiemedia.de" stash
    echo "Pull changes ..."
    git pull
    echo "Unstash changes ..."
    git stash pop
  else
    echo "Up-to-date"
  fi

  sleep 300
done